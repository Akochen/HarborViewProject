@using WebApplication3.HelperClasses;
@model AddSectionForm

@{
    ViewBag.Title = "AddSectionForm";
    Layout = "~/Views/Shared/_LayoutAdministrator.cshtml";
    //List all selectable courses
    List<SelectListItem> courseList = new List<SelectListItem>();
    courseList.Add(new SelectListItem { Value = "", Text = "---Course---" });
    foreach (var v in Model.courses)
    {
        courseList.Add(new SelectListItem { Value = v.id, Text = v.courseName });
    }
    //List all buildings
    List<SelectListItem> buildingList = new List<SelectListItem>();
    buildingList.Add(new SelectListItem { Value = "", Text = "---Building---" });
    foreach (var v in Model.buildings)
    {
        buildingList.Add(new SelectListItem { Value = v.buildingId, Text = v.buildingName });
    }
    //Create all room selectors
    Dictionary<String, List<SelectListItem>> roomLists = new Dictionary<string, List<SelectListItem>>();
    foreach (var b in Model.buildings)
    {
        //Add rooms to the proper room selectors
        List<SelectListItem> rooms = new List<SelectListItem>();
        foreach (var r in Model.locations)
        {
            if (b.buildingId == r.buildingId)
            {
                rooms.Add(new SelectListItem { Value = r.roomId, Text = r.roomName });
            }
        }
        roomLists.Add(b.buildingId, rooms);
    }
    //Create list of selectable types
    List<SelectListItem> types = new List<SelectListItem>();
    types.Add(new SelectListItem { Value = "Lecture", Text = "Lecture" });
    types.Add(new SelectListItem { Value = "Online", Text = "Online" });
    types.Add(new SelectListItem { Value = "Hybrid", Text = "Hybrid" });
    //Create list of selectable capacities
    List<SelectListItem> capacity = new List<SelectListItem>();
    for (int i = 10; i < 33; i += 5)
    {
        capacity.Add(new SelectListItem { Value = i.ToString(), Text = i + "" });
    }
    //Create list of selectable days - first day
    List<SelectListItem> days1 = new List<SelectListItem>();
    days1.Add(new SelectListItem { Value = "", Text = "Day1", Selected = true });
    days1.Add(new SelectListItem { Value = "M", Text = "M" });
    days1.Add(new SelectListItem { Value = "T", Text = "T" });
    days1.Add(new SelectListItem { Value = "W", Text = "W" });
    days1.Add(new SelectListItem { Value = "R", Text = "R" });
    days1.Add(new SelectListItem { Value = "F", Text = "F" });
    //Create list of selectable days - second day
    List<SelectListItem> days2 = new List<SelectListItem>();
    days2.Add(new SelectListItem { Value = "", Text = "Day2", Selected = true });
    days2.Add(new SelectListItem { Value = "M", Text = "M" });
    days2.Add(new SelectListItem { Value = "T", Text = "T" });
    days2.Add(new SelectListItem { Value = "W", Text = "W" });
    days2.Add(new SelectListItem { Value = "R", Text = "R" });
    days2.Add(new SelectListItem { Value = "F", Text = "F" });
    //Create list of selectable days - second day
    List<SelectListItem> days3 = new List<SelectListItem>();
    days3.Add(new SelectListItem { Value = "", Text = "Day3", Selected = true });
    days3.Add(new SelectListItem { Value = "M", Text = "M" });
    days3.Add(new SelectListItem { Value = "T", Text = "T" });
    days3.Add(new SelectListItem { Value = "W", Text = "W" });
    days3.Add(new SelectListItem { Value = "R", Text = "R" });
    days3.Add(new SelectListItem { Value = "F", Text = "F" });
    //List all selectable courses
    @*List<SelectListItem> timesList = new List<SelectListItem>();
    courseList.Add(new SelectListItem { Value = "", Text = "Start Time" });
    foreach (var v in Model.startTimes)
    {
        timesList.Add(new SelectListItem { Value = v, Text = v });
    }*@
    //Create list of credits
    List<SelectListItem> credits = new List<SelectListItem>();
    credits.Add(new SelectListItem { Value = "1", Text = "1" });
    credits.Add(new SelectListItem { Value = "2", Text = "2" });
    credits.Add(new SelectListItem { Value = "3", Text = "3" });
    credits.Add(new SelectListItem { Value = "4", Text = "4" });
    //Create semester selector
    List<SelectListItem> semesters = new List<SelectListItem>();
    semesters.Add(new SelectListItem { Value = "", Text = "Semester" });
    foreach (var v in Model.semsters)
    {
        semesters.Add(new SelectListItem { Value = v, Text = v });
    }
    //Create year selector
    List<SelectListItem> years = new List<SelectListItem>();
    years.Add(new SelectListItem { Value = "", Text = "Year" });
    foreach (var v in Model.years)
    {
        years.Add(new SelectListItem { Value = v, Text = v });
    }
}

<link rel="stylesheet" href="~/Content/Background.css" />
<form method="post">
    <table class="dataTable" id="lines">

        <tr>
            <td><strong>Course Name:</strong> </td>
            <td>
                @Html.DropDownList("courseID", courseList, null, new { required = "required" })
            </td>
        </tr>
        <tr>
            <td><strong>Building:</strong> </td>
            <td>
                @Html.DropDownList("buildingID", buildingList, null, new { onchange = "showSelected()", required = "required", @id = "buildingSelector" })
            </td>
        </tr>
        <tr>
            <td><strong>Room Number:</strong> </td>
            <td>
                @foreach (var b in Model.buildings)
                {
                    @Html.DropDownList(b.buildingId, roomLists[b.buildingId], null, new { @id = b.buildingId, required = "required" })
                }
            </td>
        </tr>
        <tr>
            <td><strong>Semester:</strong> </td>
            <td> @Html.DropDownList("Semester", semesters, new { required = "required" }) </td>
        </tr>
        <tr>
            <td><strong>Year:</strong> </td>
            <td> @Html.DropDownList("Year", years, new { required = "required" }) </td>
        </tr>
        <tr>
            <td><strong>Type of Course:</strong> </td>
            <td>
                @Html.DropDownList("type", types, new { required = "required" })
            </td>
        </tr>
        <tr>
            <td><strong>Student Capacity:</strong> </td>
            <td>
                @Html.DropDownList("capacity", capacity, new { required = "required" })
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input type="submit" value="Add" onclick="return validateForm()" />
            </td>
        </tr>
        @*<tr>
            <td><strong>Days:</strong> </td>
            <td>
                @Html.DropDownList("d1", days1, new { required = "required", @id = "d1", onchange = "d1Change()" })
                @Html.DropDownList("d2", days2, new { @id = "d2", style = "display:none;", onchange = "d2Change()" })
                @Html.DropDownList("d3", days3, new { @id = "d3", style = "display:none;" })
            </td>
        </tr>
        <tr>
            <td><strong>Start Time:</strong></td>
            <td>
                @Html.DropDownList("time", timesList, new { required = "required", @id = "startTime" })
                @Html.Hidden("end")
            </td>
        </tr>
        <tr>
            <td><strong>Credits:</strong></td>
            <td>
                @Html.DropDownList("credits", credits, new { required = "required", @id = "credits" })
            </td>
        </tr>*@
    </table>
</form>
<script>
    hideAll();
    showSelected();
    function showSelected() {
        var building = document.getElementById("buildingSelector");
        hideAll();
        if (building.value != "") {
            document.getElementById(building.value).style.display = "initial";
        }
    }

    function hideAll() {
        @foreach (var b in Model.buildings)
        {
            @Html.Raw("document.getElementById(\"" + b.buildingId + "\").style.display = \"none\"; \n")
        }
    }
    ////Show neccesary days
    //var d1 = document.getElementById("d1");
    //var d2 = document.getElementById("d2");
    //var d3 = document.getElementById("d3");
    //function d1Change() {
    //    d2.style.display = "none";
    //    d3.style.display = "none";
    //    if (d1.value != "") {
    //        d2.style.display = "initial";
    //        d2Change();
    //    } else {
    //        d2.selectedIndex = "0";
    //        d3.selectedIndex = "0";
    //    }
    //}

    //function d2Change() {
    //    d3.style.display = "none";
    //    if (d2.value != "") {
    //        d3.style.display = "initial";
    //    } else {
    //        d3.selectedIndex = "0";
    //    }
    //}

    //function validateForm() {
    //    var credits = document.getElementById("credits");
    //    if (credits.value == "1") {
    //        if (d2.value == "") {
    //            if (d3.value == "") {
    //                return true;
    //            }
    //            return false;
    //        }
    //        alert("A one credit class can only be one day per week.");
    //        return false;
    //    } else if (credits.value == "2") {
    //        if (d3.value == "") {
    //            return true;
    //        }
    //        alert("A two credit class can only run up to two days per week.");
    //        return false;
    //    } else if (credits.value = "3") {
    //        if (d2.value != "") {
    //            return true;
    //        }
    //        alert("A three credit courser must run at least twice a week.")
    //        return false;
    //    } else if (credits.value == 4) {
    //        if (d2.value != "") {
    //            return true;
    //        }
    //        alert("A four credit course must run at least twice a week.")
    //        return false;
    //    } else {
    //        alert("Error 418: Section too short and stout!")
    //        return false;
    //    }
    //}
</script>

@{
    if (IsPost)
    {
        DateTime date = Convert.ToDateTime(Request.Form["time"]);
        date = date.AddHours((double)4/(double)3);
        int c = 1;
        Response.Redirect(Url.Action("AddSection", "Administrator", new { courseId = Request.Form["courseID"], buildingId = Request.Form["buildingID"]
            , roomId = Request.Form[Request.Form["buildingID"]], semester = Request.Form["Semester"], year = Request.Form["Year"], type = Request["type"]
            , capacity = Request.Form["Capacity"]
        }));
        //, d1 = Request.Form["d1"], d2 = Request.Form["d2"], d3 = Request.Form["d3"] , startTime = Request.Form["time"]
    }
}

